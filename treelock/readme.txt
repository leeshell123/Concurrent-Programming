Below is a description of treelock:
http://stackoverflow.com/questions/18523704/peterson-lock-in-a-binary-tree

I use heaps to implement this binary tree, this could avoid building a complex binary tree building, also be space efficient.